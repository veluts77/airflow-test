<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1238px" preserveAspectRatio="none" style="width:1232px;height:1238px;background:#FFFFFF;" version="1.1" viewBox="0 0 1232 1238" width="1232px" zoomAndPan="magnify"><defs/><g><rect fill="#EEFFEE" height="1226.043" style="stroke:#181818;stroke-width:0.5;" width="265" x="231.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="353" y="18.5684">DB</text><rect fill="#FFFFEE" height="1226.043" style="stroke:#181818;stroke-width:0.5;" width="417" x="546.5" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="82" x="712" y="18.5684">Airflow DAG</text><rect height="61.9316" style="stroke:#000000;stroke-width:1.5;fill:none;" width="219" x="125" y="127.7988"/><rect height="106.5527" style="stroke:#000000;stroke-width:1.5;fill:none;" width="309.5" x="10" y="203.7305"/><rect height="224.4395" style="stroke:#000000;stroke-width:1.5;fill:none;" width="566" x="225.5" y="529.457"/><rect height="163.8184" style="stroke:#000000;stroke-width:1.5;fill:none;" width="472" x="309.5" y="553.7676"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="38" x2="38" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="38" x2="38" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="38" x2="38" y1="345.2832" y2="1152.5547"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="172" x2="172" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="172" x2="172" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="172" x2="172" y1="345.2832" y2="1152.5547"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="272.5" x2="272.5" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="272.5" x2="272.5" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="272.5" x2="272.5" y1="345.2832" y2="1152.5547"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="361.5" x2="361.5" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="361.5" x2="361.5" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="361.5" x2="361.5" y1="345.2832" y2="1152.5547"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="453.5" x2="453.5" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="453.5" x2="453.5" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="453.5" x2="453.5" y1="345.2832" y2="1152.5547"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="594.5" x2="594.5" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="594.5" x2="594.5" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="594.5" x2="594.5" y1="345.2832" y2="1152.5547"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="809" x2="809" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="809" x2="809" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="809" x2="809" y1="345.2832" y2="1152.5547"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="931.5" x2="931.5" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="931.5" x2="931.5" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="931.5" x2="931.5" y1="345.2832" y2="1152.5547"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1102" x2="1102" y1="81.4883" y2="317.2832"/><line style="stroke:#A80036;stroke-width:1.0;fill:none;stroke-dasharray:1.0,4.0;" x1="1102" x2="1102" y1="317.2832" y2="345.2832"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1102" x2="1102" y1="345.2832" y2="1152.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="20" y="78.5352">User</text><ellipse cx="38.5" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M38.5,21.5 L38.5,48.5 M25.5,29.5 L51.5,29.5 M38.5,48.5 L25.5,63.5 M38.5,48.5 L51.5,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="20" y="1165.0898">User</text><ellipse cx="38.5" cy="1176.543" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M38.5,1184.543 L38.5,1211.543 M25.5,1192.543 L51.5,1192.543 M38.5,1211.543 L25.5,1226.543 M38.5,1211.543 L51.5,1226.543 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75" x="135" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="142" y="70.5352">Input svc</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75" x="135" y="1151.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="142" y="1172.0898">Input svc</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="235.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="242.5" y="70.5352">Stage DB</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="74" x="235.5" y="1151.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="60" x="242.5" y="1172.0898">Stage DB</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="319.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="326.5" y="70.5352">Results DB</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85" x="319.5" y="1151.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="326.5" y="1172.0898">Results DB</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78" x="414.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="421.5" y="70.5352">Errors DB</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="78" x="414.5" y="1151.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="64" x="421.5" y="1172.0898">Errors DB</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="550.5" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="557.5" y="54.0469">collect and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="561.5" y="70.5352">distribute</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88" x="550.5" y="1151.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="557.5" y="1172.0898">collect and</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="561.5" y="1188.5781">distribute</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="773" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="780" y="54.0469">visualize</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="786.5" y="70.5352">results</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="73" x="773" y="1151.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="59" x="780" y="1172.0898">visualize</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="46" x="786.5" y="1188.5781">results</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="56" x="903.5" y="33.5117"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="915" y="54.0469">send</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="910.5" y="70.5352">errors</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="56" x="903.5" y="1151.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="33" x="915" y="1172.0898">send</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="910.5" y="1188.5781">errors</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="1062" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="1069" y="70.5352">Errors svc</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="1062" y="1151.5547"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="1069" y="1172.0898">Errors svc</text><polygon fill="#181818" points="160.5,108.7988,170.5,112.7988,160.5,116.7988,164.5,112.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="38.5" x2="166.5" y1="112.7988" y2="112.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="45.5" y="108.0566">запустить сервис</text><path d="M125,127.7988 L187,127.7988 L187,135.1094 L177,145.1094 L125,145.1094 L125,127.7988 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="61.9316" style="stroke:#000000;stroke-width:1.5;" width="219" x="125" y="127.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="140" y="141.3672">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137" x="202" y="140.4336">[если таблицы еще нет]</text><polygon fill="#181818" points="260.5,177.7305,270.5,181.7305,260.5,185.7305,264.5,181.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="172.5" x2="266.5" y1="181.7305" y2="181.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="179.5" y="161.6777">создаем</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="179.5" y="176.9883">таблицу</text><path d="M10,203.7305 L84,203.7305 L84,211.041 L74,221.041 L10,221.041 L10,203.7305 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="106.5527" style="stroke:#000000;stroke-width:1.5;" width="309.5" x="10" y="203.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="25" y="217.2988">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="99" y="216.3652">[несколько раз]</text><polygon fill="#181818" points="160.5,268.9727,170.5,272.9727,160.5,276.9727,164.5,272.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="38.5" x2="166.5" y1="272.9727" y2="272.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="45.5" y="237.6094">отправляем</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="45.5" y="252.9199">имя и фамилию</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="45.5" y="268.2305">через API</text><polygon fill="#181818" points="260.5,298.2832,270.5,302.2832,260.5,306.2832,264.5,302.2832" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="172.5" x2="266.5" y1="302.2832" y2="302.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="179.5" y="297.541">запись в БД</text><polygon fill="#181818" points="582.5,362.5938,592.5,366.5938,582.5,370.5938,586.5,366.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="38.5" x2="588.5" y1="366.5938" y2="366.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="45.5" y="361.8516">запустить DAG (возможен запуск по расписанию)</text><polygon fill="#181818" points="373,391.9043,363,395.9043,373,399.9043,369,395.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367" x2="593.5" y1="395.9043" y2="395.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="379" y="391.1621">пересоздать таблицу</text><polygon fill="#181818" points="464.5,436.5254,454.5,440.5254,464.5,444.5254,460.5,440.5254" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="458.5" x2="593.5" y1="440.5254" y2="440.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="470.5" y="420.4727">пересоздать</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="470.5" y="435.7832">таблицу</text><polygon fill="#181818" points="283.5,481.1465,273.5,485.1465,283.5,489.1465,279.5,485.1465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="277.5" x2="593.5" y1="485.1465" y2="485.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="289.5" y="465.0938">чтение данных из таблицы</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="289.5" y="480.4043">(еще не обработанных)</text><polygon fill="#181818" points="582.5,510.457,592.5,514.457,582.5,518.457,586.5,514.457" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="272.5" x2="588.5" y1="514.457" y2="514.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="279.5" y="509.7148">сырые имена и фамилии</text><path d="M225.5,529.457 L299.5,529.457 L299.5,536.7676 L289.5,546.7676 L225.5,546.7676 L225.5,529.457 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="224.4395" style="stroke:#000000;stroke-width:1.5;" width="566" x="225.5" y="529.457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="240.5" y="543.0254">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="179" x="314.5" y="542.0918">[для всех полученных записей]</text><path d="M309.5,553.7676 L371.5,553.7676 L371.5,561.0781 L361.5,571.0781 L309.5,571.0781 L309.5,553.7676 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="163.8184" style="stroke:#000000;stroke-width:1.5;" width="472" x="309.5" y="553.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="324.5" y="567.3359">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="172" x="386.5" y="566.4023">[запись не содержит ошибок]</text><line style="stroke:#181818;stroke-width:1.0;" x1="594.5" x2="636.5" y1="592.3887" y2="592.3887"/><line style="stroke:#181818;stroke-width:1.0;" x1="636.5" x2="636.5" y1="592.3887" y2="605.3887"/><line style="stroke:#181818;stroke-width:1.0;" x1="595.5" x2="636.5" y1="605.3887" y2="605.3887"/><polygon fill="#181818" points="605.5,601.3887,595.5,605.3887,605.5,609.3887,601.5,605.3887" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="601.5" y="587.6465">обработака (to Uppercase)</text><polygon fill="#181818" points="373,646.0098,363,650.0098,373,654.0098,369,650.0098" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367" x2="593.5" y1="650.0098" y2="650.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="379" y="629.957">добавление обработанной</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="379" y="645.2676">записи в таблицу</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="309.5" x2="781.5" y1="659.0098" y2="659.0098"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="217" x="314.5" y="669.6445">[есть ошибки (напр. цифры в имени)]</text><polygon fill="#181818" points="464.5,705.5859,454.5,709.5859,464.5,713.5859,460.5,709.5859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="458.5" x2="593.5" y1="709.5859" y2="709.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="470.5" y="689.5332">добавление</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="470.5" y="704.8438">записи с ошибкой</text><polygon fill="#181818" points="283.5,741.8965,273.5,745.8965,283.5,749.8965,279.5,745.8965" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="277.5" x2="593.5" y1="745.8965" y2="745.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="289.5" y="741.1543">запись помечается обработанной</text><polygon fill="#181818" points="797.5,778.207,807.5,782.207,797.5,786.207,801.5,782.207" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="594.5" x2="803.5" y1="782.207" y2="782.207"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="601.5" y="777.4648">передача управление по DAG</text><polygon fill="#181818" points="919.5,822.8281,929.5,826.8281,919.5,830.8281,923.5,826.8281" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="594.5" x2="925.5" y1="826.8281" y2="826.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="601.5" y="806.7754">передача управление по DAG</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="601.5" y="822.0859">(таски могут выполняться параллельно)</text><polygon fill="#181818" points="373,852.1387,363,856.1387,373,860.1387,369,856.1387" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="367" x2="808.5" y1="856.1387" y2="856.1387"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="379" y="851.3965">получение результата</text><polygon fill="#181818" points="797.5,881.4492,807.5,885.4492,797.5,889.4492,801.5,885.4492" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="362" x2="803.5" y1="885.4492" y2="885.4492"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="369" y="880.707">результат</text><line style="stroke:#181818;stroke-width:1.0;" x1="809.5" x2="851.5" y1="945.3809" y2="945.3809"/><line style="stroke:#181818;stroke-width:1.0;" x1="851.5" x2="851.5" y1="945.3809" y2="958.3809"/><line style="stroke:#181818;stroke-width:1.0;" x1="810.5" x2="851.5" y1="958.3809" y2="958.3809"/><polygon fill="#181818" points="820.5,954.3809,810.5,958.3809,820.5,962.3809,816.5,958.3809" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="816.5" y="910.0176">вывод в консоль</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="816.5" y="925.3281">результата и</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="816.5" y="940.6387">краткой сводки</text><polygon fill="#181818" points="464.5,983.6914,454.5,987.6914,464.5,991.6914,460.5,987.6914" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="458.5" x2="930.5" y1="987.6914" y2="987.6914"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="470.5" y="982.9492">получение ошибок</text><polygon fill="#181818" points="919.5,1013.002,929.5,1017.002,919.5,1021.002,923.5,1017.002" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="453.5" x2="925.5" y1="1017.002" y2="1017.002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="460.5" y="1012.2598">ошибки</text><polygon fill="#181818" points="1090.5,1057.623,1100.5,1061.623,1090.5,1065.623,1094.5,1061.623" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="931.5" x2="1096.5" y1="1061.623" y2="1061.623"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="938.5" y="1041.5703">передача информации</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="938.5" y="1056.8809">об ощибках через API</text><line style="stroke:#181818;stroke-width:1.0;" x1="1102.5" x2="1144.5" y1="1121.5547" y2="1121.5547"/><line style="stroke:#181818;stroke-width:1.0;" x1="1144.5" x2="1144.5" y1="1121.5547" y2="1134.5547"/><line style="stroke:#181818;stroke-width:1.0;" x1="1103.5" x2="1144.5" y1="1134.5547" y2="1134.5547"/><polygon fill="#181818" points="1113.5,1130.5547,1103.5,1134.5547,1113.5,1138.5547,1109.5,1134.5547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1109.5" y="1086.1914">визуализация</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="1109.5" y="1101.502">(вывод в консоль)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="1109.5" y="1116.8125">ошибок</text><!--MD5=[4f3d6ed04a6653610620341a834a9cd3]
@startuml
actor User as user
participant "Input svc" as input

box DB #eeffee
participant "Stage DB" as sdb
participant "Results DB" as rdb
participant "Errors DB" as edb
end box

box Airflow DAG #ffffee
participant "collect and\ndistribute" as collect
participant "visualize\nresults" as vis
participant "send\nerrors" as send
end box

participant "Errors svc" as errors

user -> input : запустить сервис
alt если таблицы еще нет
input -> sdb : создаем\nтаблицу
end
loop несколько раз
user -> input : отправляем\nимя и фамилию\nчерез API
input -> sdb : запись в БД
end
...
user -> collect : запустить DAG (возможен запуск по расписанию)
collect -> rdb : пересоздать таблицу
collect -> edb : пересоздать\nтаблицу
collect -> sdb : чтение данных из таблицы\n(еще не обработанных)
collect <- - sdb : сырые имена и фамилии
loop для всех полученных записей
alt запись не содержит ошибок
collect -> collect : обработака (to Uppercase)
collect -> rdb : добавление обработанной\nзаписи в таблицу
else есть ошибки (напр. цифры в имени)
collect -> edb : добавление\nзаписи с ошибкой
end
collect -> sdb : запись помечается обработанной
end

collect -> vis : передача управление по DAG
collect -> send : передача управление по DAG\n(таски могут выполняться параллельно)

rdb <- vis : получение результата
rdb - -> vis : результат
vis -> vis : вывод в консоль\nрезультата и\nкраткой сводки

edb <- send : получение ошибок
edb - -> send : ошибки
send -> errors : передача информации\nоб ощибках через API
errors -> errors : визуализация\n(вывод в консоль)\nошибок
@enduml

PlantUML version 1.2022.5(Sat Apr 30 13:55:52 MSK 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: ru
Country: RU
--></g></svg>